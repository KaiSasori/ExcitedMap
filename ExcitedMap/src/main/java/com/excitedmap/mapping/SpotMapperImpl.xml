<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.excitedmap.dao.SpotMapperImpl" >
  <resultMap id="ResultMapWithBLOBs" type="Spot" extends="com.excitedmap.dao.SpotMapper.ResultMapWithBLOBs" >
  </resultMap>
  <select id="selectBySpotCategoryId" resultMap="ResultMapWithBLOBs" >
    select *
    from spot
    where spot_category_id = #{spotCategoryId};
  </select>
  <select id="selectByOrderByFavoriteCountWithLimit" resultMap="ResultMapWithBLOBs" >
    select * from spot
    natural join (SELECT spot_id, COUNT(*) as spot_id_favorite_count from favorite GROUP BY spot_id) as A
    order by spot_id_favorite_count DESC LIMIT #{limit};
  </select>
  <select id="selectByOrderByWishCountWithLimit" resultMap="ResultMapWithBLOBs" >
    select * from spot
    natural join (SELECT spot_id, COUNT(*) as spot_id_wish_count from wish GROUP BY spot_id) as A
    order by spot_id_wish_count DESC LIMIT #{limit};
  </select>
  <select id="selectByOrderByFootprintCountWithLimit" resultMap="ResultMapWithBLOBs" >
    select * from spot
    natural join (SELECT spot_id, COUNT(*) as spot_id_footprint_count from footprint GROUP BY spot_id) as A
    order by spot_id_footprint_count DESC LIMIT #{limit};
  </select>
  <select id="selectByOrderByAverageReviewRating" resultMap="ResultMapWithBLOBs" >
  	select * from spot
  	natural join (select spot_id, avg(review_rating) as review_rating_avg from review GROUP BY spot_id) as A
  	order by review_rating_avg DESC LIMIT #{limit};
  </select>
  <select id="selectBySpotNameKeyword" resultMap="ResultMapWithBLOBs" >
    select * from spot
    where spot_name like '%${keyword}%';
  </select>
</mapper>